<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Essentials Readiness Checker - Powered by Cyber 3D</title>
    <link rel="stylesheet" href="assessment.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info" id="user-info"></div>
            <button class="logout-button" id="logout-button" onclick="logout()">Logout</button>
            <h1>Cyber Essentials Readiness Checker - Powered by Cyber 3D</h1>
            <div class="subtitle-row">
                <p>AI-Powered Assessment Tool for Small Businesses</p>
                <button class="how-it-works-link" onclick="showWelcomeModal()">How This Works</button>
            </div>
        </div>

        <div class="main-content">

            <!-- Control 1: Firewalls -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(1)">
                    <div class="control-number">1</div>
                    <div class="control-title">
                        <h3>Firewalls</h3>
                        <p>Block unauthorized access to your network</p>
                    </div>
                    <div class="toggle-icon" id="toggle-1">&#9660;</div>
                </div>
                <div class="control-content" id="content-1">
                    <div class="question" data-control="1" data-critical="true">
                        <div class="question-text">Are all your work devices (computers, laptops, servers) protected by a firewall?</div>
                        <div class="question-help">This includes built-in software firewalls or network firewalls. Every device must have protection.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1_1" value="pass"><span>Yes, all devices are protected by firewalls (built-in or network)</span></label>
                            <label class="option"><input type="radio" name="q1_1" value="fail"><span>No, some devices don't have firewall protection</span></label>
                            <label class="option"><input type="radio" name="q1_1" value="unsure"><span>I'm not sure</span></label>
                        </div>
                        <button class="ask-consultant-btn" data-question-id="q1_1" onclick="askConsultant(this)">Ask Consultant</button>
                        <div class="consultant-response" id="consultant-q1_1"></div>
                    </div>

                    <div class="question" data-control="1" data-critical="true">
                        <div class="question-text">Have you changed all default passwords on routers, firewalls, and network devices?</div>
                        <div class="question-help">Default passwords like "admin/admin" are publicly known and must be changed.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1_2" value="pass"><span>Yes, all default passwords have been changed to strong, unique passwords</span></label>
                            <label class="option"><input type="radio" name="q1_2" value="fail"><span>No, we're still using default passwords on some devices</span></label>
                            <label class="option"><input type="radio" name="q1_2" value="unsure"><span>I'm not sure what the current passwords are</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="1" data-critical="true">
                        <div class="question-text">Are your firewalls configured to block incoming connections by default?</div>
                        <div class="question-help">This is the "deny all" approach - block everything unless specifically allowed.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1_3" value="pass"><span>Yes, incoming connections are blocked by default</span></label>
                            <label class="option"><input type="radio" name="q1_3" value="fail"><span>No, our firewalls allow incoming connections by default</span></label>
                            <label class="option"><input type="radio" name="q1_3" value="unsure"><span>I don't know our firewall configuration</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="1" data-critical="false">
                        <div class="question-text">Do you document and approve all firewall rules that allow inbound connections?</div>
                        <div class="question-help">You must keep records of what's allowed through and why there's a business need.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1_4" value="pass"><span>Yes, all firewall rules are documented with business justification</span></label>
                            <label class="option"><input type="radio" name="q1_4" value="fail"><span>No, we don't document firewall rules</span></label>
                            <label class="option"><input type="radio" name="q1_4" value="partial"><span>We have some documentation but it's incomplete</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="1" data-critical="false">
                        <div class="question-text">Are employees who work remotely or use public WiFi using software firewalls on their devices?</div>
                        <div class="question-help">Public networks are untrusted - devices need their own firewall protection.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1_5" value="pass"><span>Yes, all remote workers have software firewalls enabled</span></label>
                            <label class="option"><input type="radio" name="q1_5" value="fail"><span>No, remote devices don't have software firewalls</span></label>
                            <label class="option"><input type="radio" name="q1_5" value="na"><span>Not applicable - we don't have remote workers</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="1" data-critical="false">
                        <div class="question-text">What firewall solution(s) do you use?<span class="required-indicator">*</span></div>
                        <div class="question-help">Please specify the make, model, and version of your primary firewall(s). Include both hardware firewalls (e.g., Cisco ASA, Fortinet FortiGate, pfSense) and software firewalls (e.g., Windows Defender Firewall, Sophos). If using multiple, list all.</div>
                        <textarea class="text-input" id="q1_firewall_details" placeholder="Example: Fortinet FortiGate 60F (v7.0.5), Windows Defender Firewall on all endpoints" rows="3" style="resize: vertical; min-height: 80px;"></textarea>
                    </div>
                </div>
            </div>

            <!-- Control 2: Secure Configuration -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(2)">
                    <div class="control-number">2</div>
                    <div class="control-title">
                        <h3>Secure Configuration</h3>
                        <p>Set up devices and software safely from the start</p>
                    </div>
                    <div class="toggle-icon" id="toggle-2">&#9660;</div>
                </div>
                <div class="control-content" id="content-2">
                    <div class="question" data-control="2" data-critical="true">
                        <div class="question-text">Have you removed or disabled unnecessary user accounts (like guest accounts)?</div>
                        <div class="question-help">Unused accounts are security risks. Only active, needed accounts should exist.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2_1" value="pass"><span>Yes, all unnecessary accounts have been removed/disabled</span></label>
                            <label class="option"><input type="radio" name="q2_1" value="fail"><span>No, we still have guest accounts or other unnecessary accounts enabled</span></label>
                            <label class="option"><input type="radio" name="q2_1" value="unsure"><span>I'm not sure what accounts exist on our systems</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="2" data-critical="true">
                        <div class="question-text">Have you removed or disabled unnecessary software and applications?</div>
                        <div class="question-help">Unnecessary software increases your attack surface. Only keep what you actually use.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2_2" value="pass"><span>Yes, we regularly review and remove unused software</span></label>
                            <label class="option"><input type="radio" name="q2_2" value="fail"><span>No, devices have pre-installed software we don't use</span></label>
                            <label class="option"><input type="radio" name="q2_2" value="partial"><span>We've removed some but haven't done a complete review</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="2" data-critical="true">
                        <div class="question-text">Is auto-run/auto-execute disabled on all devices?</div>
                        <div class="question-help">Auto-run allows files to execute without user permission - this must be disabled.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2_3" value="pass"><span>Yes, auto-run is disabled on all devices</span></label>
                            <label class="option"><input type="radio" name="q2_3" value="fail"><span>No, auto-run is still enabled</span></label>
                            <label class="option"><input type="radio" name="q2_3" value="unsure"><span>I don't know if auto-run is enabled or disabled</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="2" data-critical="true">
                        <div class="question-text">Do all devices require authentication before accessing organizational data or services?</div>
                        <div class="question-help">Users must prove who they are before getting access to business systems.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2_4" value="pass"><span>Yes, all devices require authentication before access</span></label>
                            <label class="option"><input type="radio" name="q2_4" value="fail"><span>No, some devices/services can be accessed without authentication</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="2" data-critical="true">
                        <div class="question-text">Do all devices have screen lock enabled with a password/PIN of at least 6 characters?</div>
                        <div class="question-help">Devices must lock when not in use and require credentials to unlock.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2_5" value="pass"><span>Yes, all devices have screen lock with 6+ character password/PIN</span></label>
                            <label class="option"><input type="radio" name="q2_5" value="fail"><span>No, some devices don't have screen lock or use shorter PINs</span></label>
                            <label class="option"><input type="radio" name="q2_5" value="partial"><span>Most devices have screen lock but I'm not sure about all of them</span></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control 3: Security Updates -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(3)">
                    <div class="control-number">3</div>
                    <div class="control-title">
                        <h3>Security Update Management</h3>
                        <p>Keep all software up to date with security patches</p>
                    </div>
                    <div class="toggle-icon" id="toggle-3">&#9660;</div>
                </div>
                <div class="control-content" id="content-3">
                    <div class="question" data-control="3" data-critical="true">
                        <div class="question-text">Is all software on your devices licensed and currently supported by the vendor?</div>
                        <div class="question-help">Unsupported software (like Windows 7) no longer receives security updates and must be removed.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q3_1" value="pass"><span>Yes, all software is licensed and supported</span></label>
                            <label class="option"><input type="radio" name="q3_1" value="fail"><span>No, we have some unsupported or unlicensed software</span></label>
                            <label class="option"><input type="radio" name="q3_1" value="unsure"><span>I'm not sure about the support status of all our software</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="3" data-critical="true">
                        <div class="question-text">Are automatic updates enabled wherever possible?</div>
                        <div class="question-help">Automatic updates help ensure you don't miss critical security patches.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q3_2" value="pass"><span>Yes, automatic updates are enabled on all devices</span></label>
                            <label class="option"><input type="radio" name="q3_2" value="fail"><span>No, automatic updates are disabled</span></label>
                            <label class="option"><input type="radio" name="q3_2" value="partial"><span>Automatic updates are enabled on some but not all devices</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="3" data-critical="true">
                        <div class="question-text">Do you install critical/high-risk security updates within 14 days of release?</div>
                        <div class="question-help">Critical updates (CVSS score 7+) must be applied within 14 days. This is mandatory.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q3_3" value="pass"><span>Yes, we install critical updates within 14 days</span></label>
                            <label class="option"><input type="radio" name="q3_3" value="fail"><span>No, updates often take longer than 14 days</span></label>
                            <label class="option"><input type="radio" name="q3_3" value="unsure"><span>We install updates but don't track timing</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="3" data-critical="false">
                        <div class="question-text">Do you have a process to track when software will become unsupported?</div>
                        <div class="question-help">Knowing when support ends lets you plan upgrades before it's too late.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q3_4" value="pass"><span>Yes, we track support end dates and plan accordingly</span></label>
                            <label class="option"><input type="radio" name="q3_4" value="fail"><span>No, we don't track support lifecycles</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="3" data-critical="false">
                        <div class="question-text">List any software you're currently using that might be outdated:<span class="required-indicator">*</span></div>
                        <div class="question-help">Examples: Windows 7, Office 2010, old versions of Adobe, etc. If none, write "None".</div>
                        <input type="text" class="text-input" id="q3_5" placeholder="Enter software names or 'None'">
                    </div>
                </div>
            </div>

            <!-- Control 4: User Access Control -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(4)">
                    <div class="control-number">4</div>
                    <div class="control-title">
                        <h3>User Access Control</h3>
                        <p>Manage who can access what in your organization</p>
                    </div>
                    <div class="toggle-icon" id="toggle-4">&#9660;</div>
                </div>
                <div class="control-content" id="content-4">
                    <div class="question" data-control="4" data-critical="true">
                        <div class="question-text">Does every user have their own unique account (no shared logins)?</div>
                        <div class="question-help">Shared accounts make it impossible to track who did what. Everyone needs their own login.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_1" value="pass"><span>Yes, every person has their own unique account</span></label>
                            <label class="option"><input type="radio" name="q4_1" value="fail"><span>No, some people share accounts</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="4" data-critical="true">
                        <div class="question-text">Do you promptly remove or disable accounts when people leave the organization?</div>
                        <div class="question-help">Former employees shouldn't retain access. Accounts should be disabled immediately.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_2" value="pass"><span>Yes, accounts are disabled/removed when people leave</span></label>
                            <label class="option"><input type="radio" name="q4_2" value="fail"><span>No, we don't have a consistent process for this</span></label>
                            <label class="option"><input type="radio" name="q4_2" value="partial"><span>We do this but sometimes there are delays</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="4" data-critical="true">
                        <div class="question-text">Is Multi-Factor Authentication (MFA) enabled on ALL cloud services?</div>
                        <div class="question-help">This is MANDATORY. Office 365, Google Workspace, Dropbox, etc. must all have MFA enabled.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_3" value="pass"><span>Yes, MFA is enabled on all cloud services</span></label>
                            <label class="option"><input type="radio" name="q4_3" value="fail"><span>No, some cloud services don't have MFA enabled</span></label>
                            <label class="option"><input type="radio" name="q4_3" value="unsure"><span>I'm not sure if all services have MFA</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="4" data-critical="true">
                        <div class="question-text">Do administrators use separate accounts for admin tasks vs. regular work?</div>
                        <div class="question-help">Admin accounts should ONLY be used for administrative tasks, not email or web browsing.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_4" value="pass"><span>Yes, admins have separate accounts for admin work</span></label>
                            <label class="option"><input type="radio" name="q4_4" value="fail"><span>No, admins use one account for everything</span></label>
                            <label class="option"><input type="radio" name="q4_4" value="na"><span>Not applicable - we don't have admin accounts</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="4" data-critical="true">
                        <div class="question-text">What password approach do you use?</div>
                        <div class="question-help">You must use one of these approaches to meet Cyber Essentials requirements.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_5" value="pass"><span>MFA with 8+ character passwords</span></label>
                            <label class="option"><input type="radio" name="q4_5" value="pass"><span>12+ character passwords (no MFA required)</span></label>
                            <label class="option"><input type="radio" name="q4_5" value="pass"><span>8+ character passwords with common password blocking</span></label>
                            <label class="option"><input type="radio" name="q4_5" value="fail"><span>None of the above / shorter passwords without MFA</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="4" data-critical="false">
                        <div class="question-text">Do you have protection against password guessing (throttling or account lockout)?</div>
                        <div class="question-help">After failed login attempts, the system should slow down or lock the account.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4_6" value="pass"><span>Yes, we have throttling or lockout (max 10 attempts in 5 min)</span></label>
                            <label class="option"><input type="radio" name="q4_6" value="fail"><span>No protection against brute force attacks</span></label>
                            <label class="option"><input type="radio" name="q4_6" value="unsure"><span>I'm not sure</span></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control 5: Malware Protection -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(5)">
                    <div class="control-number">5</div>
                    <div class="control-title">
                        <h3>Malware Protection</h3>
                        <p>Defend against viruses and malicious software</p>
                    </div>
                    <div class="toggle-icon" id="toggle-5">&#9660;</div>
                </div>
                <div class="control-content" id="content-5">
                    <div class="question" data-control="5" data-critical="true">
                        <div class="question-text">What malware protection do you use?</div>
                        <div class="question-help">You must use at least one of these options on all devices.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q5_1" value="pass"><span>Anti-malware software (Windows Defender, Norton, etc.) - active and updated</span></label>
                            <label class="option"><input type="radio" name="q5_1" value="pass"><span>Application allow listing (only approved apps can run)</span></label>
                            <label class="option"><input type="radio" name="q5_1" value="fail"><span>No malware protection or it's not active/updated</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="5" data-critical="true">
                        <div class="question-text">Is anti-malware software enabled and running on all devices?</div>
                        <div class="question-help">The software must be active, not just installed. It should run automatically.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q5_2" value="pass"><span>Yes, anti-malware is active on all devices</span></label>
                            <label class="option"><input type="radio" name="q5_2" value="fail"><span>No, it's disabled on some devices or not installed</span></label>
                            <label class="option"><input type="radio" name="q5_2" value="na"><span>N/A - using application allow listing instead</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="5" data-critical="true">
                        <div class="question-text">Is anti-malware software kept up to date automatically?</div>
                        <div class="question-help">Virus definitions must be current to protect against new threats.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q5_3" value="pass"><span>Yes, automatic updates are enabled</span></label>
                            <label class="option"><input type="radio" name="q5_3" value="fail"><span>No, updates are manual or not happening</span></label>
                            <label class="option"><input type="radio" name="q5_3" value="na"><span>N/A - using application allow listing instead</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="5" data-critical="false">
                        <div class="question-text">Does your anti-malware prevent connections to known malicious websites?</div>
                        <div class="question-help">Good anti-malware blocks access to dangerous sites before you can visit them.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q5_4" value="pass"><span>Yes, malicious website blocking is enabled</span></label>
                            <label class="option"><input type="radio" name="q5_4" value="fail"><span>No, this feature isn't enabled</span></label>
                            <label class="option"><input type="radio" name="q5_4" value="unsure"><span>I don't know if this feature is enabled</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="5" data-critical="false">
                        <div class="question-text">What anti-malware/antivirus software and version are you using?<span class="required-indicator">*</span></div>
                        <div class="question-help">Please specify the product name and version number for all anti-malware solutions in use. Examples: Windows Defender (built-in with Windows 11), Norton 360 v22.23.1, Sophos Intercept X v10.3, CrowdStrike Falcon v6.47. If using different solutions on different devices, please list all.</div>
                        <textarea class="text-input" id="q5_malware_details" placeholder="Example: Windows Defender (Windows 11 built-in), Bitdefender Endpoint Security v7.2 on servers" rows="3" style="resize: vertical; min-height: 80px;"></textarea>
                    </div>
                </div>
            </div>

            <!-- Scope Questions -->
            <div class="assessment-section">
                <div class="control-header" onclick="toggleControl(6)">
                    <div class="control-number">&#128203;</div>
                    <div class="control-title">
                        <h3>Scope &amp; Context</h3>
                        <p>Understanding what's in scope for your assessment</p>
                    </div>
                    <div class="toggle-icon" id="toggle-6">&#9660;</div>
                </div>
                <div class="control-content" id="content-6">
                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Are you including ALL your IT infrastructure in the certification scope?</div>
                        <div class="question-help">Full scope provides the best protection. Partial scope needs justification.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6_1" value="pass"><span>Yes, all IT infrastructure is in scope</span></label>
                            <label class="option"><input type="radio" name="q6_1" value="partial"><span>No, we're using a partial scope (subset)</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="6" data-critical="true">
                        <div class="question-text">Are ALL cloud services (Office 365, Google Workspace, Dropbox, etc.) included in scope?</div>
                        <div class="question-help">Cloud services CANNOT be excluded from scope. This is mandatory.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6_2" value="pass"><span>Yes, all cloud services are in scope</span></label>
                            <label class="option"><input type="radio" name="q6_2" value="fail"><span>No, we've excluded some cloud services</span></label>
                            <label class="option"><input type="radio" name="q6_2" value="na"><span>We don't use any cloud services</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Do employees use personal devices (BYOD) to access work data or services?</div>
                        <div class="question-help">Personal devices accessing work data are in scope too.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6_3" value="pass"><span>Yes, and those devices are included in our assessment</span></label>
                            <label class="option"><input type="radio" name="q6_3" value="fail"><span>Yes, but we haven't included them in scope</span></label>
                            <label class="option"><input type="radio" name="q6_3" value="na"><span>No BYOD - all devices are company-owned</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">How many devices are in scope for this assessment?<span class="required-indicator">*</span></div>
                        <div class="question-help">Include computers, laptops, tablets, phones, servers - anything accessing business data.</div>
                        <input type="number" class="text-input" id="q6_4" placeholder="Enter number of devices" min="1">
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">List the cloud services you use for business:<span class="required-indicator">*</span></div>
                        <div class="question-help">Examples: Microsoft 365, Google Workspace, Dropbox, Salesforce, Xero, etc.</div>
                        <input type="text" class="text-input" id="q6_5" placeholder="Enter cloud services (comma-separated)">
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Do you have a documented backup and recovery procedure?</div>
                        <div class="question-help">While not required for Cyber Essentials, backups are critical for business continuity and ransomware recovery.</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6_backup" value="pass"><span>Yes, we have automated daily backups with documented recovery procedures</span></label>
                            <label class="option"><input type="radio" name="q6_backup" value="partial"><span>We have backups but they're not fully automated or documented</span></label>
                            <label class="option"><input type="radio" name="q6_backup" value="fail"><span>We have occasional backups but no formal procedure</span></label>
                            <label class="option"><input type="radio" name="q6_backup" value="fail"><span>No regular backup procedure in place</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Please describe your backup solution and frequency:<span class="required-indicator">*</span></div>
                        <div class="question-help">Include: What is backed up, where backups are stored, how often, retention period, and how you test recovery.</div>
                        <textarea class="text-input" id="q6_backup_details" placeholder="Example: Daily automated backups of all file servers and databases to Azure Backup. 30-day retention. Monthly recovery tests. Offsite cloud storage." rows="4" style="resize: vertical; min-height: 100px;"></textarea>
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Do you have a documented incident response plan?</div>
                        <div class="question-help">An incident response plan defines what to do when a security incident occurs (e.g., malware infection, data breach, ransomware attack).</div>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6_incident" value="pass"><span>Yes, we have a documented and tested incident response plan</span></label>
                            <label class="option"><input type="radio" name="q6_incident" value="partial"><span>We have a basic plan but it hasn't been tested</span></label>
                            <label class="option"><input type="radio" name="q6_incident" value="fail"><span>We have informal procedures but nothing documented</span></label>
                            <label class="option"><input type="radio" name="q6_incident" value="fail"><span>No incident response plan</span></label>
                        </div>
                    </div>

                    <div class="question" data-control="6" data-critical="false">
                        <div class="question-text">Please describe your incident response procedures:<span class="required-indicator">*</span></div>
                        <div class="question-help">Include: Who to contact first, escalation procedures, how incidents are logged, communication plan, and recovery steps.</div>
                        <textarea class="text-input" id="q6_incident_details" placeholder="Example: 1) Isolate affected systems 2) Contact IT Manager (John Smith) 3) Log in incident tracking system 4) Notify management within 2 hours 5) Engage external security consultant if needed 6) Document and perform post-incident review" rows="4" style="resize: vertical; min-height: 100px;"></textarea>
                    </div>
                </div>
            </div>

            <!-- Save / Load Bar -->
            <div class="save-load-bar">
                <button id="save-btn" onclick="saveAssessment()" class="export-button" style="flex: 1;">
                    Save Progress
                </button>
                <button onclick="loadAssessment()" class="export-button" style="flex: 1;">
                    Load Saved
                </button>
                <button onclick="clearSavedAssessment()" class="export-button danger" style="flex: 1;">
                    Clear Saved
                </button>
            </div>

            <button class="analyze-button" onclick="analyzeAssessment()">
                Analyze My Cyber Essentials Readiness
            </button>

            <!-- Results Section -->
            <div class="results" id="results">
                <div class="result-header">
                    <div class="result-status" id="status-icon"></div>
                    <div class="result-title" id="status-title">Analyzing...</div>
                    <div class="result-subtitle" id="status-subtitle">Please wait while AI evaluates your responses</div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%">
                        <span id="progress-text">0%</span>
                    </div>
                </div>

                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <!-- Welcome Modal (first-visit only) -->
    <div id="welcome-overlay" class="welcome-overlay">
        <div class="welcome-modal">
            <h2>How This Works</h2>
            <p>This intelligent assessment tool will evaluate your business against the UK Cyber Essentials requirements (v3.3). Answer the questions honestly, and we'll analyze your responses to determine if you're ready for certification and identify any gaps that need addressing.</p>
            <p class="welcome-note"><strong>Note:</strong> This tool includes AI-powered analysis for enhanced insights. If AI analysis is unavailable, you'll still receive a comprehensive local assessment based on your responses.</p>
            <p class="welcome-note"><strong>Your Privacy:</strong> Your responses are processed entirely within your browser and are never stored on our servers. Auto-saved progress is held in your browser's local storage only. AI analysis is sent through a secure, encrypted connection and is not retained after your session. No personal or assessment data is shared with third parties.</p>
            <button class="welcome-dismiss-button" onclick="dismissWelcomeModal()">Start Assessment</button>
        </div>
    </div>

    <!-- Welcome modal logic -->
    <script>
        function showWelcomeModal() {
            var overlay = document.getElementById('welcome-overlay');
            if (overlay) {
                overlay.style.display = 'flex';
                overlay.classList.add('show');
            }
        }

        function dismissWelcomeModal() {
            var overlay = document.getElementById('welcome-overlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('show');
            }
            localStorage.setItem('ce-checker-welcome-seen', 'true');
        }

        // Show on first visit only, after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            if (!localStorage.getItem('ce-checker-welcome-seen')) {
                showWelcomeModal();
            }

            // Attach listeners as backup for inline onclick
            var dismissBtn = document.querySelector('.welcome-dismiss-button');
            if (dismissBtn) {
                dismissBtn.addEventListener('click', dismissWelcomeModal);
            }

            var howLink = document.querySelector('.how-it-works-link');
            if (howLink) {
                howLink.addEventListener('click', showWelcomeModal);
            }
        });
    </script>

    <!-- Ask Consultant logic -->
    <script>
        // Hardcoded system prompt for CE guidance queries
        var CONSULTANT_SYSTEM_PROMPT = 'You are a UK Cyber Essentials (v3.3) certification consultant. ' +
            'Your role is to help small businesses understand the specific Cyber Essentials requirements ' +
            'related to each assessment question. ' +
            'RULES: ' +
            '- Explain the official CE requirement in plain, non-technical language. ' +
            '- Describe WHY this requirement exists and what risk it mitigates. ' +
            '- Give 1-2 practical examples of how a small business can meet the requirement. ' +
            '- If relevant, mention common mistakes or misconceptions. ' +
            '- Keep your response concise (under 150 words). ' +
            '- Do NOT assess or score the user. Only explain and guide. ' +
            '- Reference the Cyber Essentials v3.3 standard where appropriate.';

        // Cache to avoid repeat API calls for the same question
        var consultantCache = {};

        function askConsultant(button) {
            var questionId = button.getAttribute('data-question-id');
            var responseDiv = document.getElementById('consultant-' + questionId);
            var questionDiv = button.closest('.question');
            var questionText = questionDiv.querySelector('.question-text').textContent;
            var helpText = questionDiv.querySelector('.question-help').textContent;

            // Toggle: if response is visible and already loaded, just collapse it
            if (responseDiv.classList.contains('show') && responseDiv.dataset.loaded === 'true') {
                responseDiv.classList.remove('show');
                return;
            }

            // If cached, show immediately
            if (consultantCache[questionId]) {
                responseDiv.innerHTML = consultantCache[questionId];
                responseDiv.dataset.loaded = 'true';
                responseDiv.classList.add('show');
                return;
            }

            // Show loading state
            button.disabled = true;
            button.textContent = 'Consulting...';
            responseDiv.innerHTML = '<div class="consultant-loading">Consulting Cyber Essentials guidance...</div>';
            responseDiv.classList.add('show');

            var userPrompt = 'The user is answering the following Cyber Essentials assessment question:\n\n' +
                'Question: ' + questionText + '\n' +
                'Guidance hint: ' + helpText + '\n\n' +
                'Please explain the Cyber Essentials requirement related to this question. ' +
                'What does the standard require, why does it matter, and how can a small business comply?';

            fetch('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: userPrompt,
                    systemPrompt: CONSULTANT_SYSTEM_PROMPT,
                    max_tokens: 500,
                    model: 'claude-sonnet-4-5-20250929',
                    temperature: 0.2
                })
            })
            .then(function(response) {
                if (!response.ok) {
                    return response.json().then(function(errData) {
                        var detail = errData.details || errData.error || response.status;
                        throw new Error(detail);
                    }).catch(function(parseErr) {
                        if (parseErr.message && parseErr.message !== String(response.status)) throw parseErr;
                        throw new Error('API request failed: ' + response.status);
                    });
                }
                return response.json();
            })
            .then(function(data) {
                if (data.error) throw new Error(data.error);

                var text = '';
                if (data.content && Array.isArray(data.content)) {
                    var textContent = data.content.find(function(c) { return c.type === 'text'; });
                    text = textContent ? textContent.text : '';
                } else if (data.text) {
                    text = data.text;
                }

                if (!text) throw new Error('No response text');

                var html = '<div class="consultant-answer">' +
                    '<strong>CE Consultant:</strong> ' + text.replace(/\n/g, '<br>') +
                    '</div>';
                consultantCache[questionId] = html;
                responseDiv.innerHTML = html;
                responseDiv.dataset.loaded = 'true';
            })
            .catch(function(err) {
                console.error('Ask Consultant error:', err);
                var msg = err.message || 'Unknown error';
                responseDiv.innerHTML = '<div class="consultant-error">Consultant unavailable: ' +
                    msg.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';
                responseDiv.dataset.loaded = '';
            })
            .finally(function() {
                button.disabled = false;
                button.textContent = 'Ask Consultant';
            });
        }
    </script>

    <!-- Application logic (extracted) -->
    <script src="assessment.js"></script>

    <!-- Firebase Authentication -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { firebaseConfig } from './firebase-config.js';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        let hasCheckedAuth = false;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                hasCheckedAuth = true;
                const userInfo = document.getElementById('user-info');
                if (userInfo) {
                    const displayName = user.displayName ||
                        localStorage.getItem('userName') ||
                        user.email.split('@')[0];
                    userInfo.textContent = displayName;
                }
                localStorage.removeItem('firebaseAuthComplete');
            } else {
                if (!hasCheckedAuth) {
                    hasCheckedAuth = true;
                    setTimeout(() => {
                        if (!auth.currentUser) {
                            localStorage.removeItem('firebaseAuthComplete');
                            window.location.href = 'index.html';
                        }
                    }, 1000);
                } else {
                    window.location.href = 'index.html';
                }
            }
        }, () => {
            window.location.href = 'index.html';
        });

        window.logout = async function () {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    localStorage.clear();
                    window.location.href = 'index.html';
                } catch (error) {
                    alert('Error logging out: ' + error.message);
                }
            }
        };
    </script>
</body>
</html>
